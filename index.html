<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Meu Treino</title>
  
  <!-- Configura√ß√µes para iOS e PWA -->
  <meta name="apple-mobile-web-app-title" content="Meu Treino">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  
  <!-- O √≠cone ser√° injetado via JavaScript para garantir que funcione sem arquivos externos -->
  <link rel="icon" id="favicon-link">
  <link rel="apple-touch-icon" id="apple-icon-link">

  <!-- Carrega o Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Carrega Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    /* Fonte Inter para visual moderno */
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');

    body {
      font-family: 'Inter', sans-serif;
      transition: background-color 0.3s, color 0.3s;
      -webkit-tap-highlight-color: transparent; /* Remove highlight de toque no mobile */
    }
    
    /* Temas */
    body[data-theme="light"] { background: #f8fafc; color: #1e293b; }
    body[data-theme="dark"] { background: #0f172a; color: #f8fafc; }

    /* Transi√ß√µes suaves */
    .card, header, #settings-panel, .m-content, .tab-btn {
      transition: all 0.3s ease;
    }

    /* Estilos Dark Mode Espec√≠ficos */
    body[data-theme="dark"] .card { background: #1e293b; border-color: #334155; }
    body[data-theme="dark"] .tab-btn { color: #94a3b8; }
    body[data-theme="dark"] .tab-btn.active { background: #3b82f6; color: #fff; }
    body[data-theme="dark"] input { background: #334155; border-color: #475569; color: #fff; }

    /* Modal */
    #confirmation-modal {
      position: fixed; inset: 0; background: rgba(0,0,0,0.6);
      z-index: 1000; display: none; align-items: center; justify-content: center;
      backdrop-filter: blur(2px);
    }

    /* Anima√ß√£o do Check */
    @keyframes pop {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }
    .check-btn.checked { animation: pop 0.2s ease-in-out; }
  </style>
</head>
<body data-theme="light" class="pb-safe">
  
  <!-- Cabe√ßalho -->
  <header class="bg-white dark:bg-slate-900 p-4 border-b border-slate-200 dark:border-slate-800 flex items-center justify-between sticky top-0 z-20 shadow-sm">
    <div class="flex items-center gap-3">
      <!-- Logo gerado via CSS/SVG (Nunca falha) -->
      <div id="app-logo" class="w-10 h-10 rounded-xl shadow-md bg-blue-600 flex items-center justify-center text-white font-bold text-xl select-none">
        T
      </div>
      <div>
        <h1 id="header-title" class="text-lg font-extrabold text-blue-600 dark:text-blue-400 m-0 leading-tight">Treino de Hoje</h1>
        <div class="text-xs text-slate-500 dark:text-slate-400">Ol√°, <span id="show-user-name" class="font-semibold">Atleta</span></div>
      </div>
    </div>
    <button class="w-10 h-10 rounded-full bg-slate-50 dark:bg-slate-800 hover:bg-slate-100 dark:hover:bg-slate-700 flex items-center justify-center text-xl transition-colors" onclick="toggleSettings()">
      ‚öôÔ∏è
    </button>
  </header>

  <!-- Painel de Configura√ß√µes -->
  <div id="settings-panel" class="fixed top-20 right-4 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-2xl shadow-2xl p-5 w-72 hidden z-30 transform transition-all duration-200 origin-top-right">
    <h3 class="text-lg font-bold text-slate-800 dark:text-white mb-4">Configura√ß√µes</h3>
    
    <label class="text-xs font-bold text-slate-500 uppercase tracking-wide">Nome</label>
    <div class="flex gap-2 mb-4 mt-1">
      <input id="edit-user-name" type="text" class="flex-1 p-2 rounded-lg border border-slate-300 text-sm focus:outline-none focus:border-blue-500" placeholder="Seu nome">
      <button onclick="saveUserNameSettings()" class="bg-blue-600 text-white px-3 py-2 rounded-lg text-sm font-semibold">OK</button>
    </div>
    
    <hr class="border-slate-100 dark:border-slate-700 my-4">
    
    <label class="text-xs font-bold text-slate-500 uppercase tracking-wide">Apar√™ncia</label>
    <button onclick="toggleTheme()" class="flex items-center justify-between w-full p-3 mt-2 rounded-xl bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 transition-colors">
      <span id="theme-label" class="text-sm font-medium dark:text-slate-200">Modo Claro</span>
      <span id="theme-icon">üåô</span>
    </button>
  </div>

  <!-- Navega√ß√£o (Tabs) -->
  <div class="sticky top-[73px] z-10 bg-white/95 dark:bg-slate-900/95 backdrop-blur-sm border-b border-slate-200 dark:border-slate-800 py-2">
    <div class="flex overflow-x-auto px-4 gap-2 no-scrollbar pb-1">
      <button class="tab-btn whitespace-nowrap px-4 py-2 rounded-full text-sm font-semibold bg-transparent text-slate-600" onclick="renderDay('Segunda')">Segunda</button>
      <button class="tab-btn whitespace-nowrap px-4 py-2 rounded-full text-sm font-semibold bg-transparent text-slate-600" onclick="renderDay('Ter√ßa')">Ter√ßa</button>
      <button class="tab-btn whitespace-nowrap px-4 py-2 rounded-full text-sm font-semibold bg-transparent text-slate-600" onclick="renderDay('Quarta')">Quarta</button>
      <button class="tab-btn whitespace-nowrap px-4 py-2 rounded-full text-sm font-semibold bg-transparent text-slate-600" onclick="renderDay('Quinta')">Quinta</button>
      <button class="tab-btn whitespace-nowrap px-4 py-2 rounded-full text-sm font-semibold bg-transparent text-slate-600" onclick="renderDay('Resumo')">Resumo</button>
    </div>
  </div>

  <!-- Conte√∫do -->
  <div class="max-w-xl mx-auto px-4 py-6 mb-20" id="app-content"></div>

  <!-- Gr√°fico -->
  <div class="max-w-xl mx-auto px-4 mb-10">
    <div class="bg-white dark:bg-slate-800 rounded-2xl p-5 shadow-sm border border-slate-200 dark:border-slate-700">
      <h2 class="text-base font-bold text-slate-800 dark:text-white mb-4 flex items-center gap-2">
        <span class="text-blue-500">üìä</span> Desempenho Semanal
      </h2>
      <div class="relative h-48 w-full">
        <canvas id="chart-semana"></canvas>
      </div>
      <div id="info-metricas" class="text-xs text-slate-500 mt-4 text-center"></div>
    </div>
  </div>

  <!-- Modal Boas Vindas -->
  <div id="user-modal" class="hidden fixed inset-0 bg-black/50 z-50 items-center justify-center p-4 backdrop-blur-sm">
    <div class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-2xl w-full max-w-sm text-center">
      <div class="w-16 h-16 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center mx-auto mb-4 text-3xl">üí™</div>
      <h2 class="text-xl font-bold text-slate-900 dark:text-white mb-2">Bem-vindo ao Treino!</h2>
      <p class="text-slate-500 dark:text-slate-400 mb-6 text-sm">Como voc√™ gostaria de ser chamado?</p>
      <input id="input-user-name" type="text" class="w-full p-3 rounded-xl border border-slate-300 dark:border-slate-600 mb-4 bg-slate-50 dark:bg-slate-700 text-center text-lg font-medium outline-none focus:ring-2 ring-blue-500" placeholder="Seu Nome">
      <button onclick="saveUserNameModal()" class="w-full py-3 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-xl transition-transform active:scale-95">Come√ßar</button>
    </div>
  </div>

  <!-- Modal Confirma√ß√£o Reset -->
  <div id="confirmation-modal">
    <div class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-2xl w-full max-w-xs text-center mx-4">
      <div class="w-12 h-12 bg-red-100 text-red-500 rounded-full flex items-center justify-center mx-auto mb-3 text-xl">‚ö†Ô∏è</div>
      <h3 class="text-lg font-bold text-slate-900 dark:text-white mb-2">Reiniciar Semana?</h3>
      <p class="text-slate-500 dark:text-slate-400 text-sm mb-6">Todo o seu progresso desta semana ser√° apagado.</p>
      <div class="flex gap-3">
        <button id="confirm-cancel" class="flex-1 py-2.5 rounded-xl bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300 font-semibold text-sm">Cancelar</button>
        <button id="confirm-ok" class="flex-1 py-2.5 rounded-xl bg-red-500 text-white font-semibold text-sm shadow-lg shadow-red-500/30">Confirmar</button>
      </div>
    </div>
  </div>

  <script>
    // --- L√ìGICA DO LOGO AUTOM√ÅTICO (CORRE√á√ÉO DEFINITIVA) ---
    // Cria um SVG din√¢mico para usar como Favicon e Apple Touch Icon
    // Isso garante que o √≠cone na tela inicial do iOS seja um "T" azul bonito e n√£o um "F" ou screenshot
    const logoSVG = `
      <svg xmlns="http://www.w3.org/2000/svg" width="512" height="512" viewBox="0 0 512 512">
        <rect width="512" height="512" rx="120" fill="#2563eb"/>
        <path d="M130 150h252v60h-96v200h-60v-200h-96z" fill="white"/>
      </svg>
    `;
    const blob = new Blob([logoSVG], { type: 'image/svg+xml' });
    const url = URL.createObjectURL(blob);
    document.getElementById('favicon-link').href = url;
    document.getElementById('apple-icon-link').href = url;
    
    // --- Configura√ß√µes Tailwind ---
    tailwind.config = {
      darkMode: 'class',
      theme: { extend: { colors: { 'slate-850': '#1e293b' } } }
    }

    // --- Dados do Treino ---
    const workoutData = {
      Segunda: { focus: "Peito e Tr√≠ceps", exercises: [
        { id: "s1", name: "Supino Inclinado", sets: 4, reps: "8-12" },
        { id: "s2", name: "Supino M√°quina", sets: 4, reps: "10-12" },
        { id: "s3", name: "Voador", sets: 4, reps: "12-15" },
        { id: "s4", name: "Tr√≠ceps Franc√™s", sets: 4, reps: "10-12" },
        { id: "s5", name: "Tr√≠ceps Barra V", sets: 4, reps: "12" },
        { id: "s6", name: "Eleva√ß√£o Lateral", sets: 4, reps: "15" }
      ]},
      Ter√ßa: { focus: "Costas e B√≠ceps", exercises: [
        { id: "t1", name: "Puxada Alta", sets: 4, reps: "10-12" },
        { id: "t2", name: "Remada Baixa", sets: 4, reps: "10-12" },
        { id: "t3", name: "Serrote", sets: 4, reps: "10" },
        { id: "t4", name: "Rosca Direta W", sets: 4, reps: "10-12" },
        { id: "t5", name: "Rosca 45¬∫", sets: 4, reps: "12" }
      ]},
      Quarta: { focus: "Pernas", exercises: [
        { id: "q1", name: "Agachamento", sets: 4, reps: "8-10" },
        { id: "q2", name: "Leg Press", sets: 4, reps: "10-12" },
        { id: "q3", name: "Extensora", sets: 4, reps: "15" },
        { id: "q4", name: "Flexora", sets: 4, reps: "12-15" },
        { id: "q5", name: "Panturrilhas", sets: 4, reps: "15-20" }
      ]},
      Quinta: { focus: "Ombros e Bra√ßos", exercises: [
        { id: "qi1", name: "Desenvolvimento", sets: 4, reps: "8-10" },
        { id: "qi2", name: "Eleva√ß√£o Lateral", sets: 4, reps: "12-15" },
        { id: "qi3", name: "Rosca Martelo", sets: 4, reps: "12" },
        { id: "qi4", name: "Tr√≠ceps Corda", sets: 4, reps: "12-15" }
      ]}
    };

    const DB_KEY = "meutreino_v2_state";
    let appState = JSON.parse(localStorage.getItem(DB_KEY)) || null;

    if (!appState) {
      appState = { theme: "light", userName: "", completed: {}, weights: {}, lastWeekReset: 0 };
      localStorage.setItem(DB_KEY, JSON.stringify(appState));
    }

    let currentDay = getAutoDay();

    function getWeekNumber(date = new Date()){
      const d=new Date(Date.UTC(date.getFullYear(),date.getMonth(),date.getDate()));
      const dayNum = d.getUTCDay()||7;
      d.setUTCDate(d.getUTCDate()+4-dayNum);
      const yearStart=new Date(Date.UTC(d.getUTCFullYear(),0,1));
      return Math.ceil((((d-yearStart)/86400000)+1)/7);
    }

    function weeklyResetIfNeeded(){
      const weekNow=getWeekNumber();
      if(appState.lastWeekReset!=weekNow){
        appState.completed={};
        appState.lastWeekReset=weekNow;
        saveState();
      }
    }

    function saveState(){localStorage.setItem(DB_KEY,JSON.stringify(appState));}

    function openUserModal(){document.getElementById("user-modal").classList.remove("hidden");document.getElementById("user-modal").classList.add("flex");}
    
    function saveUserNameModal(){
      const name=document.getElementById("input-user-name").value.trim();
      if(name.length>0){appState.userName=name;saveState();document.getElementById("user-modal").classList.remove("flex");document.getElementById("user-modal").classList.add("hidden");renderAll();}
    }

    function saveUserNameSettings(){
      const name=document.getElementById("edit-user-name").value.trim();
      if(name.length>0){appState.userName=name;saveState(); toggleSettings(); renderAll();}
    }

    function renderUserName(){
      document.getElementById("show-user-name").innerText=appState.userName||"Atleta";
      document.getElementById("edit-user-name").value=appState.userName||"";
    }

    function toggleSettings(){
      const p = document.getElementById("settings-panel");
      p.classList.toggle("hidden");
    }

    function toggleTheme(){
      appState.theme=appState.theme==="light"?"dark":"light";
      saveState();
      renderAll();
    }

    function getAutoDay(){
      const d=new Date().getDay();
      const map = {1:"Segunda", 2:"Ter√ßa", 3:"Quarta", 4:"Quinta"};
      return map[d] || "Segunda";
    }

    function renderAll(){
      const isDark = appState.theme === 'dark';
      document.body.setAttribute("data-theme", appState.theme);
      
      // Update UI texts
      document.getElementById("theme-label").innerText = isDark ? "Modo Escuro" : "Modo Claro";
      document.getElementById("theme-icon").innerText = isDark ? "üåô" : "‚òÄÔ∏è";
      
      renderUserName();
      renderDay(currentDay);
      renderSemanaChart();
    }

    function renderDay(day){
      currentDay=day;
      
      // Update Tabs
      document.querySelectorAll('.tab-btn').forEach(btn=>{
        const active = btn.innerText === day;
        btn.className = `tab-btn whitespace-nowrap px-5 py-2 rounded-full text-sm font-bold transition-all ${
          active 
          ? 'bg-blue-600 text-white shadow-lg shadow-blue-500/30' 
          : 'bg-slate-100 dark:bg-slate-800 text-slate-500 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700'
        }`;
      });
      
      const container=document.getElementById('app-content');
      container.innerHTML='';

      if(day==='Resumo'){
        renderResumo(container);
        document.getElementById('header-title').innerText="Resumo Semanal";
      }else{
        document.getElementById('header-title').innerHTML = `
          ${day} <span class="block text-xs font-normal text-slate-400 dark:text-slate-500 mt-0.5">${workoutData[day].focus}</span>
        `;
        renderExercises(container,workoutData[day].exercises);
      }
    }

    function renderExercises(container,exercises){
      exercises.forEach((ex)=>{
        const isDone=appState.completed[ex.id];
        const weight=appState.weights[ex.id]||'';
        
        const card=document.createElement('div');
        card.className = `card relative overflow-hidden bg-white dark:bg-slate-800 rounded-2xl p-4 mb-3 border-l-4 shadow-sm ${
          isDone ? 'border-l-emerald-500' : 'border-l-blue-500'
        } border-y border-r border-slate-100 dark:border-slate-700`;
        
        card.innerHTML=`
          <div class="flex justify-between items-start gap-4">
            <div class="flex-1">
              <h3 class="text-base font-bold text-slate-800 dark:text-slate-100 leading-tight mb-1">${ex.name}</h3>
              <span class="inline-block bg-slate-100 dark:bg-slate-700 text-slate-500 dark:text-slate-300 px-2 py-0.5 rounded text-xs font-semibold tracking-wide">${ex.sets} x ${ex.reps}</span>
              
              <div class="flex items-center gap-2 mt-3">
                <div class="bg-slate-50 dark:bg-slate-900 rounded-lg p-1 flex items-center border border-slate-200 dark:border-slate-700">
                  <input type="number" inputmode="numeric" 
                    class="w-12 text-center bg-transparent font-bold text-slate-700 dark:text-white outline-none" 
                    placeholder="0" value="${weight}" 
                    onchange="updateWeight('${ex.id}',this.value)"
                    onclick="this.select()">
                  <span class="text-xs text-slate-400 font-medium pr-1">kg</span>
                </div>
              </div>
            </div>
            
            <button onclick="toggleCheck('${ex.id}')" 
              class="check-btn h-12 w-12 rounded-xl flex items-center justify-center text-2xl transition-all shadow-sm ${
              isDone 
              ? 'checked bg-emerald-500 text-white shadow-emerald-500/30' 
              : 'bg-slate-50 dark:bg-slate-700 text-slate-300 dark:text-slate-600 border border-slate-200 dark:border-slate-600'
            }">
              ${isDone ? '‚úì' : ''}
            </button>
          </div>
        `;
        container.appendChild(card);
      });
    }

    function renderResumo(container){
      let total=0,done=0;Object.keys(workoutData).forEach(d=>{workoutData[d].exercises.forEach(ex=>{total++;if(appState.completed[ex.id])done++;});});
      const pct = Math.round((done/total)*100) || 0;
      
      container.innerHTML=`
        <div class="bg-white dark:bg-slate-800 rounded-3xl p-8 mb-6 shadow-sm border border-slate-200 dark:border-slate-700 text-center relative overflow-hidden">
          <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-500 to-purple-500"></div>
          <div class="text-6xl font-black text-slate-800 dark:text-white mb-2 tracking-tighter">${pct}%</div>
          <p class="text-slate-500 dark:text-slate-400 text-sm font-medium uppercase tracking-widest">Conclu√≠do</p>
          <div class="mt-6 text-xs text-slate-400 bg-slate-50 dark:bg-slate-900 py-2 px-4 rounded-full inline-block">
            ${done} de ${total} exerc√≠cios
          </div>
        </div>
        
        <button onclick="showResetModal()" class="w-full bg-red-50 hover:bg-red-100 dark:bg-red-900/20 dark:hover:bg-red-900/30 text-red-600 dark:text-red-400 font-bold py-4 rounded-2xl transition-colors text-sm flex items-center justify-center gap-2">
          <span>üóëÔ∏è</span> Reiniciar Semana
        </button>
        `;
    }

    function toggleCheck(id){
      if(appState.completed[id]){delete appState.completed[id];}
      else{appState.completed[id]=true;}
      saveState();
      // Pequeno delay visual para sentir o clique
      setTimeout(() => {
        renderDay(currentDay);
        renderSemanaChart();
      }, 50);
    }

    function updateWeight(id,value){
      appState.weights[id]=value;
      saveState();
      renderSemanaChart();
    }

    function showResetModal() {
        const modal = document.getElementById('confirmation-modal');
        modal.style.display = 'flex';
        document.getElementById('confirm-ok').onclick = () => { resetWeekAction(); modal.style.display = 'none'; };
        document.getElementById('confirm-cancel').onclick = () => { modal.style.display = 'none'; };
    }

    function resetWeekAction(){
        appState.completed={};
        saveState();
        renderDay(getAutoDay());
        renderSemanaChart();
    }

    // --- CHART.JS CONFIG ---
    let chartInstance = null;
    function renderSemanaChart(){
      const ctx = document.getElementById('chart-semana')?.getContext('2d');
      if(!ctx) return;

      const dias=['Segunda','Ter√ßa','Quarta','Quinta'];
      // Dados
      const checks=dias.map(d=>workoutData[d]?workoutData[d].exercises.filter(e=>appState.completed[e.id]).length:0);
      
      // Cores Din√¢micas
      const isDark = appState.theme === 'dark';
      const colorBar = isDark ? '#3b82f6' : '#2563eb';
      const colorBg = isDark ? '#1e293b' : '#ffffff';
      const colorText = isDark ? '#94a3b8' : '#64748b';

      if(chartInstance) chartInstance.destroy();

      chartInstance = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['Seg', 'Ter', 'Qua', 'Qui'],
          datasets: [{
            label: 'Exerc√≠cios',
            data: checks,
            backgroundColor: colorBar,
            borderRadius: 6,
            barThickness: 20
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { display: false } },
          scales: {
            y: { 
              beginAtZero: true, 
              grid: { color: isDark ? '#334155' : '#e2e8f0', drawBorder: false },
              ticks: { color: colorText, font: {family: 'Inter', size: 10} }
            },
            x: { 
              grid: { display: false },
              ticks: { color: colorText, font: {family: 'Inter', size: 11, weight: '600'} }
            }
          }
        }
      });
      
      const totalChecks = checks.reduce((a,b)=>a+b,0);
      document.getElementById('info-metricas').innerText = totalChecks > 0 
        ? `üî• ${totalChecks} exerc√≠cios conclu√≠dos esta semana!` 
        : "Comece a treinar para ver seus dados aqui.";
    }

    window.onload = function(){
      weeklyResetIfNeeded();
      if(!appState.userName || appState.userName==="") openUserModal();
      else renderAll();
    }
  </script>
</body>
</html>
