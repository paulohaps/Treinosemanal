<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Meu Treino</title>
  <!-- Carrega o Tailwind CSS para um design responsivo e moderno -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Carrega Chart.js para o gr√°fico de progresso -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="apple-touch-icon" sizes="180x180" href="icon.png">

  <style>
    /* Configura√ß√µes b√°sicas e tema escuro */
    body {
      font-family: 'Inter', sans-serif;
      transition: background-color 0.3s, color 0.3s;
    }
    body[data-theme="light"] {
      background: #f8fafc; /* slate-50 */
      color: #1e293b; /* slate-800 */
    }
    body[data-theme="dark"] {
      background: #1e293b; /* slate-800 */
      color: #f8fafc; /* slate-50 */
    }
    .card, header, #settings-panel, .m-content {
      transition: background-color 0.3s, border-color 0.3s, box-shadow 0.3s;
    }
    body[data-theme="dark"] .card, 
    body[data-theme="dark"] header,
    body[data-theme="dark"] #settings-panel,
    body[data-theme="dark"] .grafico-metricas,
    body[data-theme="dark"] #user-modal .m-content {
      background: #334155; /* slate-700 */
      border-color: #475569; /* slate-600 */
      color: #f8fafc;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }
    body[data-theme="dark"] .tab-btn { color: #cbd5e1; /* slate-300 */ }
    body[data-theme="dark"] .tab-btn.active { background: #60a5fa; color: #1e293b; } /* blue-400 */
    body[data-theme="dark"] .tag,
    body[data-theme="dark"] .settings-btn { background: #475569; /* slate-600 */ color: #f8fafc; }
    body[data-theme="dark"] input.input-weight { background: #475569; border-color: #64748b; color: #f8fafc; }
    body[data-theme="dark"] .check-btn { background: #475569; border-color: #94a3b8; color: #e2e8f0; }
    body[data-theme="dark"] .check-btn.checked { background: #10b981; border-color: #10b981; color: #fff; }

    /* Estilo para o modal customizado de confirma√ß√£o */
    #confirmation-modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      display: none;
      align-items: center;
      justify-content: center;
    }
  </style>
</head>
<body data-theme="light">
  <!-- Cabe√ßalho -->
  <header class="bg-white p-4 border-b border-slate-200 flex items-center justify-between sticky top-0 z-10 shadow-sm">
    <div class="flex items-center">
      <!-- Imagem de placeholder para o √≠cone, j√° que "icon.png" n√£o est√° dispon√≠vel no ambiente -->
      <img src="https://placehold.co/40x40/2563eb/ffffff?text=F" class="w-10 h-10 rounded-lg mr-4 shadow-md" alt="Logo">
      <div>
        <h1 id="header-title" class="text-xl font-extrabold text-blue-600 m-0">Treino de Hoje</h1>
        <div class="text-sm text-slate-500 mt-0.5">Usu√°rio: <span id="show-user-name" class="font-medium"></span></div>
      </div>
    </div>
    <button class="settings-btn bg-slate-100 border-none rounded-full w-9 h-9 cursor-pointer text-xl text-slate-600 flex items-center justify-center shadow-sm" onclick="toggleSettings()">‚öôÔ∏è</button>
  </header>

  <!-- Painel de Configura√ß√µes -->
  <div id="settings-panel" class="absolute top-16 right-4 bg-white dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-xl shadow-xl p-4 w-64 hidden z-20">
    <h3 class="mt-0 text-lg font-semibold text-blue-600 dark:text-blue-400">Configura√ß√µes</h3>
    <hr class="my-3 border-slate-200 dark:border-slate-600">
    <label class="text-sm font-medium text-slate-600 dark:text-slate-300">Nome de usu√°rio:</label>
    <input id="edit-user-name" type="text" class="w-full p-2 mt-1 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-blue-500 focus:border-blue-500 mb-3 text-slate-800 dark:bg-slate-800 dark:text-white" placeholder="Seu nome">
    <button onclick="saveUserNameSettings()" class="w-full py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow-md transition duration-150">Salvar nome</button>
    <hr class="my-3 border-slate-200 dark:border-slate-600">
    <label class="text-sm font-medium text-slate-600 dark:text-slate-300">Tema:</label>
    <button onclick="toggleTheme()" class="flex items-center justify-between px-4 py-2 mt-2 rounded-full bg-slate-100 dark:bg-slate-600 hover:bg-slate-200 dark:hover:bg-slate-500 border-none w-full text-slate-800 dark:text-white font-medium">
      <span id="theme-label">Claro</span>
      <span id="theme-icon">üåô</span>
    </button>
  </div>

  <!-- Tabs (Navega√ß√£o dos Dias) -->
  <div class="flex justify-center bg-slate-100 dark:bg-slate-800 py-3 border-b border-slate-200 dark:border-slate-800 shadow-inner overflow-x-auto whitespace-nowrap">
    <button class="tab-btn" onclick="renderDay('Segunda')">Segunda</button>
    <button class="tab-btn" onclick="renderDay('Ter√ßa')">Ter√ßa</button>
    <button class="tab-btn" onclick="renderDay('Quarta')">Quarta</button>
    <button class="tab-btn" onclick="renderDay('Quinta')">Quinta</button>
    <button class="tab-btn" onclick="renderDay('Resumo')">Resumo</button>
  </div>

  <!-- Conte√∫do Principal do Treino -->
  <div class="max-w-xl mx-auto px-4 mt-6" id="app-content">
    <!-- Exerc√≠cios ser√£o renderizados aqui -->
  </div>

  <!-- Progresso e Gr√°fico de M√©tricas -->
  <div class="grafico-metricas max-w-xl mx-auto mt-6 mb-8 bg-white dark:bg-slate-700 rounded-xl p-4 shadow-lg border border-slate-200 dark:border-slate-600">
    <h2 class="text-lg font-bold text-blue-600 dark:text-blue-400 mb-4">Seu Progresso da Semana</h2>
    <canvas id="chart-semana" class="max-w-full h-52"></canvas>
    <div id="info-metricas" class="text-sm text-slate-600 mt-4 dark:text-slate-300"></div>
  </div>

  <!-- Modal de Boas-vindas/Nome do Usu√°rio -->
  <div id="user-modal" class="hidden fixed inset-0 bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm z-[9999] items-center justify-center">
    <div class="m-content bg-white dark:bg-slate-700 p-6 rounded-2xl shadow-2xl text-center border border-slate-200 dark:border-slate-600 w-11/12 max-w-sm">
      <h2 class="text-2xl font-bold text-blue-600 dark:text-blue-400 mb-3">Bem-vindo! üí™</h2>
      <p class="text-slate-600 dark:text-slate-300 mb-4">Digite seu nome para come√ßar a registrar seu treino:</p>
      <input id="input-user-name" type="text" class="w-full p-3 border border-slate-300 dark:border-slate-600 rounded-lg text-lg mb-4 text-slate-800 dark:bg-slate-800 dark:text-white" placeholder="Seu nome">
      <button onclick="saveUserNameModal()" class="w-full py-3 border-none rounded-lg bg-blue-600 hover:bg-blue-700 text-white font-extrabold text-lg shadow-lg shadow-blue-500/50 transition duration-150">Salvar</button>
    </div>
  </div>

  <!-- Modal de Confirma√ß√£o Customizado (Substitui confirm()) -->
  <div id="confirmation-modal">
    <div class="bg-white dark:bg-slate-700 p-6 rounded-xl shadow-2xl text-center border border-slate-200 dark:border-slate-600 w-11/12 max-w-xs">
      <h3 class="text-xl font-bold mb-3 text-red-600 dark:text-red-400">Reiniciar Semana?</h3>
      <p class="text-slate-700 dark:text-slate-200 mb-6">Tem certeza? Isso apagar√° todos os exerc√≠cios conclu√≠dos desta semana.</p>
      <div class="flex justify-between gap-3">
        <button id="confirm-cancel" class="flex-1 py-2 rounded-lg bg-slate-200 dark:bg-slate-600 text-slate-700 dark:text-slate-200 font-semibold hover:bg-slate-300 dark:hover:bg-slate-500 transition duration-150">Cancelar</button>
        <button id="confirm-ok" class="flex-1 py-2 rounded-lg bg-red-600 text-white font-semibold hover:bg-red-700 transition duration-150">Confirmar</button>
      </div>
    </div>
  </div>


  <script>
    // Configura√ß√£o do Tailwind (para cores no JS)
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            'blue-main': '#2563eb', // blue-600
            'green-done': '#10b981', // emerald-500
            'slate-light': '#f1f5f9', // slate-100
          }
        }
      }
    }

    const workoutData = {
      Segunda: { focus: "Peito e Tr√≠ceps", exercises: [
        { id: "s1", name: "Supino Inclinado", sets: 4, reps: "8-12" },
        { id: "s2", name: "Supino M√°quina", sets: 4, reps: "10-12" },
        { id: "s3", name: "Voador", sets: 4, reps: "12-15" },
        { id: "s4", name: "Tr√≠ceps Franc√™s", sets: 4, reps: "10-12" },
        { id: "s5", name: "Tr√≠ceps Barra V", sets: 4, reps: "12" },
        { id: "s6", name: "Eleva√ß√£o Lateral", sets: 4, reps: "15" }
      ]},
      Ter√ßa: { focus: "Costas e B√≠ceps", exercises: [
        { id: "t1", name: "Puxada Alta", sets: 4, reps: "10-12" },
        { id: "t2", name: "Remada Baixa", sets: 4, reps: "10-12" },
        { id: "t3", name: "Serrote", sets: 4, reps: "10" },
        { id: "t4", name: "Rosca Direta W", sets: 4, reps: "10-12" },
        { id: "t5", name: "Rosca 45¬∫", sets: 4, reps: "12" }
      ]},
      Quarta: { focus: "Pernas", exercises: [
        { id: "q1", name: "Agachamento", sets: 4, reps: "8-10" },
        { id: "q2", name: "Leg Press", sets: 4, reps: "10-12" },
        { id: "q3", name: "Extensora", sets: 4, reps: "15" },
        { id: "q4", name: "Flexora", sets: 4, reps: "12-15" },
        { id: "q5", name: "Panturrilhas", sets: 4, reps: "15-20" }
      ]},
      Quinta: { focus: "Ombros e Bra√ßos", exercises: [
        { id: "qi1", name: "Desenvolvimento", sets: 4, reps: "8-10" },
        { id: "qi2", name: "Eleva√ß√£o Lateral", sets: 4, reps: "12-15" },
        { id: "qi3", name: "Rosca Martelo", sets: 4, reps: "12" },
        { id: "qi4", name: "Tr√≠ceps Corda", sets: 4, reps: "12-15" }
      ]}
    };

    const DB_KEY = "meutreino_state";
    let appState = JSON.parse(localStorage.getItem(DB_KEY)) || null;

    // Inicializa√ß√£o do estado se n√£o existir
    if (!appState) {
      appState = { theme: "light", userName: "", completed: {}, weights: {}, lastWeekReset: 0 };
      localStorage.setItem(DB_KEY, JSON.stringify(appState));
    }

    let currentDay = getAutoDay();

    function getWeekNumber(date = new Date()){
      const d=new Date(Date.UTC(date.getFullYear(),date.getMonth(),date.getDate()));
      const dayNum = d.getUTCDay()||7;
      d.setUTCDate(d.getUTCDate()+4-dayNum);
      const yearStart=new Date(Date.UTC(d.getUTCFullYear(),0,1));
      return Math.ceil((((d-yearStart)/86400000)+1)/7);
    }

    function weeklyResetIfNeeded(){
      const weekNow=getWeekNumber();
      if(appState.lastWeekReset!=weekNow){
        appState.completed={};
        appState.lastWeekReset=weekNow;
        saveState();
      }
    }

    function saveState(){localStorage.setItem(DB_KEY,JSON.stringify(appState));}

    function openUserModal(){document.getElementById("user-modal").classList.remove("hidden");document.getElementById("user-modal").classList.add("flex");}
    
    function saveUserNameModal(){
      const name=document.getElementById("input-user-name").value.trim();
      if(name.length>0){appState.userName=name;saveState();document.getElementById("user-modal").classList.remove("flex");document.getElementById("user-modal").classList.add("hidden");renderAll();}
    }

    function saveUserNameSettings(){
      const name=document.getElementById("edit-user-name").value.trim();
      if(name.length>0){appState.userName=name;saveState();renderAll();}
    }

    function renderUserName(){
      document.getElementById("show-user-name").innerText=appState.userName||"";
      document.getElementById("edit-user-name").value=appState.userName||"";
    }

    function toggleSettings(){document.getElementById("settings-panel").classList.toggle("hidden");}

    function toggleTheme(){
      appState.theme=appState.theme==="light"?"dark":"light";
      document.body.setAttribute("data-theme",appState.theme);
      document.getElementById("theme-label").innerText=appState.theme==="light"?"Claro":"Escuro";
      document.getElementById("theme-icon").innerText=appState.theme==="light"?"üåô":"‚òÄÔ∏è";
      saveState();
      renderSemanaChart(); // Chart colors might change
    }

    function getAutoDay(){
      const d=new Date().getDay();
      if(d==1)return"Segunda";
      if(d==2)return"Ter√ßa";
      if(d==3)return"Quarta";
      if(d==4)return"Quinta";
      return"Segunda";
    }

    function renderAll(){
      // Aplica o tema
      document.body.setAttribute("data-theme",appState.theme||"light");
      document.getElementById("theme-label").innerText=appState.theme==="light"?"Claro":"Escuro";
      document.getElementById("theme-icon").innerText=appState.theme==="light"?"üåô":"‚òÄÔ∏è";

      renderUserName();
      renderDay(currentDay);
      renderSemanaChart();
    }

    function renderDay(day){
      currentDay=day;
      document.querySelectorAll('.tab-btn').forEach(btn=>{
        btn.classList.remove('active', 'bg-blue-600', 'text-white', 'shadow-md', 'shadow-blue-600/30', 'dark:bg-blue-400', 'dark:text-slate-800');
        btn.classList.add('bg-transparent', 'text-slate-600', 'dark:text-slate-300', 'px-4', 'py-2', 'mx-0.5', 'text-base', 'rounded-full', 'cursor-pointer', 'font-semibold');
        
        if(btn.innerText===day){
          btn.classList.add('active', 'bg-blue-600', 'text-white', 'shadow-md', 'shadow-blue-600/30', 'dark:bg-blue-400', 'dark:text-slate-800');
          btn.classList.remove('bg-transparent', 'text-slate-600', 'dark:text-slate-300');
        }
      });
      
      const container=document.getElementById('app-content');
      container.innerHTML='';

      if(day==='Resumo'){
        renderResumo(container);
        document.getElementById('header-title').innerText="Resumo Semanal";
      }else{
        document.getElementById('header-title').innerText=day + " - " + workoutData[day].focus;
        renderExercises(container,workoutData[day].exercises);
      }
    }

    function renderExercises(container,exercises){
      exercises.forEach((ex)=>{
        const isDone=appState.completed[ex.id];
        const weight=appState.weights[ex.id]||'';
        const card=document.createElement('div');
        
        // Classes Tailwind para o Card
        const cardClasses = `card bg-white dark:bg-slate-700 rounded-xl shadow-lg p-4 mb-4 border border-slate-200 dark:border-slate-600 flex justify-between items-center flex-wrap ${isDone ? 'border-emerald-500 shadow-emerald-500/10' : ''}`;

        card.className = cardClasses;
        
        card.innerHTML=`
          <div class="card-content flex-1">
            <h3 class="text-lg font-bold mb-1">${ex.name}</h3>
            <div><span class="tag bg-slate-100 dark:bg-slate-600 text-slate-600 dark:text-slate-50 px-2 py-0.5 rounded-md text-sm font-semibold">${ex.sets} x ${ex.reps}</span></div>
            <div class="input-weight-wrapper flex items-center gap-1 mt-3">
              <span class="text-xl">‚öñÔ∏è</span>
              <input type="number" class="input-weight w-12 text-base text-center border border-slate-300 dark:border-slate-600 rounded-lg p-1 text-slate-800 dark:bg-slate-800 dark:text-white" placeholder="0" value="${weight}" onchange="updateWeight('${ex.id}',this.value)">
              <span class="input-label text-slate-500 dark:text-slate-400">kg</span>
            </div>
          </div>
          <div class="card-actions flex flex-col gap-2 ml-4">
            <button class="check-btn w-9 h-9 rounded-full border-2 border-slate-300 dark:border-slate-500 bg-white dark:bg-slate-600 text-slate-500 dark:text-slate-300 text-xl flex items-center justify-center transition duration-150 ${isDone ? 'checked !bg-emerald-500 !text-white !border-emerald-500' : ''}" onclick="toggleCheck('${ex.id}')">‚úì</button>
          </div>`;
        container.appendChild(card);
      });
    }

    function renderResumo(container){
      let total=0,done=0;Object.keys(workoutData).forEach(d=>{workoutData[d].exercises.forEach(ex=>{total++;if(appState.completed[ex.id])done++;});});
      container.innerHTML=`
        <div class="card bg-white dark:bg-slate-700 rounded-xl shadow-lg p-6 mb-4 border border-slate-200 dark:border-slate-600 text-center flex flex-col items-center">
          <div class="text-5xl font-extrabold text-blue-600 dark:text-blue-400 mb-1">${done} / ${total}</div>
          <p class="text-slate-500 dark:text-slate-400 mb-4">Exerc√≠cios totais conclu√≠dos</p>
          <button onclick="showResetModal()" class="border-none bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-6 rounded-xl shadow-md transition duration-150 cursor-pointer">Reiniciar Semana</button>
        </div>
        <div class="text-slate-500 dark:text-slate-400 text-sm mt-3 px-2">
          üí° Dica: Toque no ‚úì para marcar como feito. <br>‚öñÔ∏è Cargas: O app salva o peso digitado automaticamente.
        </div>`;
    }

    function toggleCheck(id){
      if(appState.completed[id]){delete appState.completed[id];}
      else{appState.completed[id]=true;}
      saveState();
      renderDay(currentDay);
      renderSemanaChart();
    }

    function updateWeight(id,value){
      appState.weights[id]=value;
      saveState();
      renderSemanaChart();
    }

    // Fun√ß√£o para mostrar o modal de confirma√ß√£o (substitui 'confirm()')
    function showResetModal() {
        const modal = document.getElementById('confirmation-modal');
        modal.style.display = 'flex';

        // Garante que os listeners sejam adicionados apenas uma vez ou removidos
        const confirmOk = document.getElementById('confirm-ok');
        const confirmCancel = document.getElementById('confirm-cancel');

        // Remove listeners antigos para evitar duplica√ß√£o
        confirmOk.onclick = null;
        confirmCancel.onclick = null;

        confirmOk.onclick = () => {
            resetWeekAction();
            modal.style.display = 'none';
        };

        confirmCancel.onclick = () => {
            modal.style.display = 'none';
        };
    }

    function resetWeekAction(){
        appState.completed={};
        saveState();
        renderDay(getAutoDay());
        renderSemanaChart();
    }

    // Chart semanal
    function renderSemanaChart(){
      const dias=['Segunda','Ter√ßa','Quarta','Quinta'];
      const checks=dias.map(d=>workoutData[d]?workoutData[d].exercises.filter(e=>appState.completed[e.id]).length:0);
      const totals=dias.map(d=>workoutData[d]?workoutData[d].exercises.length:0);
      const pcts=checks.map((done,i)=>totals[i]?Math.round((done/totals[i])*100):0);
      const prs=dias.map(d=>Math.max(...workoutData[d].exercises.map(e=>Number(appState.weights[e.id]||0))));
      
      const ctx=document.getElementById('chart-semana')?.getContext('2d');
      if(!ctx) return; 

      // Cores baseadas no tema
      const isDark = appState.theme === 'dark';
      const blueColor = isDark ? '#60a5fa' : '#2563EB'; // blue-400 or blue-600
      const greenColor = isDark ? '#34d399' : '#10B981'; // emerald-400 or emerald-500
      const textColor = isDark ? '#e2e8f0' : '#1e293b'; // slate-200 or slate-800
      const gridColor = isDark ? '#475569' : '#e2e8f0'; // slate-600 or slate-200

      if(window.chartSemana){window.chartSemana.destroy();}
      
      window.chartSemana=new Chart(ctx,{
        type:'bar',
        data:{
          labels:dias,
          datasets:[
            {label:'Exerc√≠cios conclu√≠dos',data:checks,backgroundColor:blueColor},
            {label:'PR do Dia (kg)',data:prs,backgroundColor:greenColor}
          ]
        },
        options:{
          responsive: true,
          maintainAspectRatio: false,
          scales:{
            y:{
              beginAtZero:true,
              ticks: { color: textColor },
              grid: { color: gridColor }
            },
            x:{
              ticks: { color: textColor },
              grid: { color: gridColor }
            }
          },
          plugins: {
            legend: {
              labels: { color: textColor }
            }
          }
        }
      });

      document.getElementById('info-metricas').innerHTML =
        `<p class="mt-2 text-slate-600 dark:text-slate-300">Progresso do Dia (%): ${pcts.map((p,i)=>dias[i]+': '+p+'%').join(' | ')}</p>`;
    }

    window.onload=function(){
      weeklyResetIfNeeded();
      if(!appState.userName||appState.userName===""){openUserModal();}
      else{renderAll();}
    }
  </script>
</body>
</html>
